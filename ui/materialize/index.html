<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>FeatureLayer using HeatmapRenderer</title>
  <link rel="stylesheet" href="http://js.arcgis.com/3.14/dijit/themes/claro/claro.css">
  <link rel="stylesheet" href="http://js.arcgis.com/3.14/esri/css/esri.css">
  <link rel="stylesheet" href="css/materialize.css">
  <style>
    html, body, #map {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map{
      display: none;
    }
    #mapSidebar{
      display: none;
    }
  </style>
  <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="js/materialize.js"></script>
  <script src="http://js.arcgis.com/3.14/"></script>


  <script>
    var map;
  
    require([
        "esri/InfoTemplate",
        "esri/layers/FeatureLayer",
        "esri/map",
        "esri/renderers/HeatmapRenderer",
        "dojo/domReady!"

      ],
      function (InfoTemplate, FeatureLayer, Map, HeatmapRenderer){

        // --------------------------------------------------------------------
        // Formatting functions for attribute values in the InfoWindow
        // Data is not what you expect, turn your dirty data into
        // readable stuff in the infowindow
        // --------------------------------------------------------------------
        formatFatalities = function (value, key, data){
          var result = value > 1 ? value + " people " : value + " person ";
          return result;
        }
        formatGender = function (value, key, data){
          var lookup = {1: "male", 2: "female", 8: "unknown", 9: "unknown"};
          return lookup[value];
        }
        formatConditions = function (value, key, data){
          var lookup = {0: "No Additional Atmospheric Conditions", 1: "Clear", 2: "Rain", 3: "Sleet, Hail (Freezing Rain or Drizzle)", 4: "Snow", 5: "Fog, Smog, Smoke", 6: "Severe Crosswinds", 7: "Blowing Sand, Soil, Dirt", 8: "Other", 10: "Cloudy", 11: "Blowing Snow", 98: "Not Reported", 99: "Unknown"};
          if (value !== 1) {
            return "Road conditions: " + lookup[value] + "<br>";
          }
        }
        formatWorkZone = function (value, key, data){
          var lookup = {0: "None", 1: "Construction", 2: "Maintenance", 3: "Utility", 4: "Work Zone, Type Unknown"};
          if (value !== 0) {
            return "Work Zone: " + lookup[value] + "<br>";
          }
        }
        formatAlcoholTestResults = function (value, key, data){
          // --------------------------------------------------------------------
          // The field is a string and we only want values of 8 - 94 since the
          // California legal limit is 0.08% BAC. If value is between 8 and 94
          // then we will report that they were over the legal limit.
          // --------------------------------------------------------------------
          var isMatch = value.match(/\b(?!9[5-9])[0-9][0-9]\b|\b[8-9]{1}\b/m);
          if (isMatch) {
            return "Driver was over the legal limit for alcohol";
          }
        }

        map = new Map("map", {
          basemap: "gray",
          center: [-119.11, 36.65],
          zoom: 7,
          minZoom: 7,
          maxZoom: 9
        });
        var infoContentDesc = "<p>${numfatal:formatFatalities} died when a ${age} year old ${sex:formatGender} was involved in a fatal speeding accident.</p>";
        var infoContentDetails = "${atmcond:formatConditions}${conszone:formatWorkZone}${alcres:formatAlcoholTestResults}";
        var infoContent = infoContentDesc + infoContentDetails;
        var infoTemplate = new InfoTemplate("Accident details", infoContent);

        var serviceURL = "//services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/2012_CA_NHTSA/FeatureServer/0";
        var heatmapFeatureLayerOptions = {
          mode: FeatureLayer.MODE_SNAPSHOT,
          infoTemplate: infoTemplate,
          outFields: [
            "atmcond",
            "numfatal",
            "conszone",
            "age",
            "alcres",
            "sex"
          ]
        };
        var heatmapFeatureLayer = new FeatureLayer(serviceURL, heatmapFeatureLayerOptions);
        var heatmapRenderer = new HeatmapRenderer();
        heatmapFeatureLayer.setRenderer(heatmapRenderer);
        map.addLayer(heatmapFeatureLayer);
      });
  </script>

  </head>
  <body>
    <div id="map"></div>
    <div id="mapSidebar" style="
    width: 300px;
    height: 300px;
  
    position: absolute;
    z-index: 30;
    top: 93px;
    
    left: 0px;
   
    ">
      <div class="row">
        <div class="col s12 ">
          <div class="card">
            <div class="card-image waves-effect waves-block waves-light">
              <img class="activator cardIMG" src="http://s3-media2.fl.yelpcdn.com/bphoto/IbaDHDUUK6HvwBcGXp3o4w/ms.jpg">
              <span class="card-title">Ms. Mong</span>
            </div>
                      
            <div class="card-reveal" style="display: none; transform: translateY(0px);">
              <span class="card-title grey-text text-darken-4">Ms. Mong<i class="material-icons right">close</i></span>
                <p>I have been here a couple times already, so I wanted to wait to write a review until I tried different things. <br> This place deserves 5 stars for many...</p>
            </div>
          </div>
          <div class="card">
            <div class="card-image waves-effect waves-block waves-light">
              <img class="activator cardIMG" src="http://s3-media1.fl.yelpcdn.com/bphoto/Tv_mocqbAq_kmi1LTdeiEw/ms.jpg">
              <span class="card-title">Lin da's Bar and Grill</span>
            </div>
                      
            <div class="card-reveal" style="display: none; transform: translateY(0px);">
              <span class="card-title grey-text text-darken-4">Ms. Mong<i class="material-icons right">close</i></span>
                <p>Amazing cheese fries, Strongbow cider on tap, and two floors (one in the basement with great couches). Not much more that you can as k for from a late night...</p>
            </div>
          </div>
          <div class="card">
            <div class="card-image waves-effect waves-block waves-light">
              <img class="activator cardIMG" src="http://s3-media2.fl.yelpcdn.com/bphoto/IbaDHDUUK6HvwBcGXp3o4w/ms.jpg">
              <span class="card-title">Ms. Mong</span>
            </div>
                      
            <div class="card-reveal" style="display: none; transform: translateY(0px);">
              <span class="card-title grey-text text-darken-4">Ms. Mong<i class="material-icons right">close</i></span>
                <p>I have been here a couple times already, so I wanted to wait to write a review until I tried different things. <br> This place deserves 5 stars for many...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
      <div id="modalRegister" class="modal">
      <div class="modal-content">
        <h4>Register</h4>
          <form class="col s12">
          <div class="row">
            <div class="input-field col s6">
              <input id="rname" type="text" class="validate">
              <label for="rname">Name</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <input id="rusername" type="text" class="validate">
              <label for="rusername">Username</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <input id="rpassword" type="password" class="validate">
              <label for="rpassword">Password</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <input id="raccount" type="text" class="validate">
              <label for="raccount">Customer ID</label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <a href="#!" id="registerButton" class=" modal-action modal-close waves-effect waves-green btn-flat">Register</a>
      </div>
    </div>
    <!-- Login Form -->
    <div id="modalLogin" class="modal">
      <div class="modal-content"> 
        <h4>Login</h4>
          <form class="col s12">
          <div class="row">
            <div class="input-field col s6">
              <input id="lusername" type="text" class="validate">
              <label for="lusername">Username</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <input id="lpassword" type="password" class="validate">
              <label for="lpassword">Password</label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <a href="#!" id="loginButton" class=" modal-action modal-close waves-effect waves-green btn-flat">Login</a>
      </div>
    </div>
  </body>
  <script src="js/script.js"></script>
<style type="text/css">
.container {
    max-width: 100%;
}
.cardIMG{
     filter: blur(50);
    
    -webkit-filter: blur(5px) grayscale(0) saturate(1.3) brightness(1);
}
</style>
</html>
